{% extends 'marketplace/base.html' %}
{% load bootstrap3 %}

{% block head %}
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/javascript">
    window.MathJax = ({
        elements: ["model-desc"],
        tex2jax: {
            inlineMath: [ ['$', '$'], [ "\\(", "\\)" ] ],
            processEscapes: true
        }
    });
</script>
{% endblock head %}

{% block content %}
<h1>{{ model.name }}</h1>

<h2>Description:</h2>
<div id="model-desc" class="container">
    <p>
        {{ model.description|linebreaks }}
    </p>
</div>


<h2>Details:</h2>
<table class="table">
    <tr>
        <td><b>Created By</b></td>
        <td><a href="{% url 'profile' user_id=model.owner.id %}">{{ model.owner.username }}</a></td>
    </tr>
    <tr>
        <td><b>Uploaded</b></td>
        <td>{{ model.upload_date }}</td>
    </tr>
    <tr>
        <td><b>Files</b></td>
        <td>
            {% if files %}
            {% for f in files %}
                <a href="{% url 'show_file' file_id=f.id %}">{{ f.name }}</a><br />
            {% endfor %}

            {% else %}
            No files uploaded yet.
            {% endif %}
        </td>
    </tr>
</table>

{% if request.user == model.owner %}
<div style="">
<a href="{% url 'edit' model_id=model.id %}" class="btn btn-primary btn-edit">{% bootstrap_icon "pencil" %} Edit Details</a>
<a href="{% url 'edit_files' model_id=model.id %}" class="btn btn-primary btn-edit">{% bootstrap_icon "file" %} Edit Files</a>
<button type="button" class="btn btn-danger delete-btn btn-edit" data-toggle="modal" data-target="#delModal">
  {% bootstrap_icon 'remove-circle' %} Delete
</button>
</div>
<!-- Modal -->
<div class="modal fade" id="delModal" tabindex="-1" role="dialog" aria-labelledby="delModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="delModalLabel">Delete Model</h4>
      </div>
      <div class="modal-body" id="del-modal-content">
        Are you sure you want to delete this model?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <a type="button" class="btn btn-danger" href="#" id="modal-del-btn">Delete</a>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
    $('.delete-btn').click(function(event) {
        modelName = "{{ model.name }}";
        deleteUrl = "{% url 'delete' model_id=model.id %}";
        $('#del-modal-content').text("Are you sure you want to delete " + modelName + "?");
        $('#modal-del-btn').attr('href', deleteUrl);
    });
</script>
{% endif %}

<h3>Comments:</h3>
{% if comments %}
    {% for comment in comments %}
        <div class="comment well">
            <div class="detail-container">
                <div class="user">
                    {{ comment.user.username }}:
                </div>
                <div class="time">
                    {{ comment.time|date:"D d M Y" }} at {{ comment.time|date:"H:i" }}
                </div>
            </div>
            <div class="content">
                {{ comment.content }}
            </div>
            {% if comment.user == request.user %}
            <div class="actions">
                <a href="{% url 'delete_comment' comment_id=comment.id %}" class="btn btn-danger btn-sm">Delete Comment</a>
            </div>
            {% endif %}
        </div>
    {% endfor %}

{% else %}
    <p>
        No comments yet.
    </p>
{% endif %}


{% endblock content %}
